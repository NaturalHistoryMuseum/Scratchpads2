/*! wavesurfer.js 1.4.0 (Tue, 09 Oct 2018 15:21:58 GMT)
* https://github.com/katspaugh/wavesurfer.js
* @license BSD-3-Clause */
!function(e,t){void 0===e&&void 0!==window&&(e=window),"function"==typeof define&&define.amd?define(["wavesurfer"],function(e){return t(e)}):"object"==typeof module&&module.exports?module.exports=t(require("wavesurfer.js")):t(e.WaveSurfer)}(this,function(m){"use strict";m.ELANWaveSegment={defaultParams:{waveSegmentWidth:200,waveSegmentPeaksPerSegment:200,waveSegmentHeight:30,waveSegmentRenderer:"Canvas",waveSegmentNormalizeTo:"whole",waveSegmentBarHeight:1,waveSegmentBorderWidth:1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI},ELAN:null,wavesurfer:null,waveSegments:[],maxPeak:0,init:function(e){switch(this.params=m.util.extend(this.defaultParams,e),this.ELAN=e.ELAN,this.wavesurfer=e.wavesurfer,this.waveSegments=[],this.maxPeak=0,this.params.waveSegmentNormalizeTo){case"segment":this.params.normalize=!0;break;case"whole":this.calculateMaxPeak(),this.params.noramlize=!1;break;default:this.params.normalize=!1}this.addSegmentColumn()},calculateMaxPeak:function(){var e=this.ELAN.renderedAlignable.length*this.params.waveSegmentWidth,t=this.wavesurfer.backend.getPeaks(e,0,e),a=m.util.max(t),i=m.util.min(t);this.maxPeak=a<-i?-i:a},addSegmentColumn:function(){var e=this.ELAN.container.getElementsByTagName("tr"),t=document.createElement("th");t.textContent="Wave",t.className="wavesurfer-wave",t.setAttribute("style","width: "+this.params.waveSegmentWidth+"px"),e[0].insertBefore(t,e[0].firstChild.nextSibling);for(var a=0;a<this.ELAN.renderedAlignable.length;a++){var i=this.ELAN.getAnnotationNode(this.ELAN.renderedAlignable[a]),n=document.createElement("td");n.className="wavesurfer-wave",this.appendWaveSegmentToElement(n,a),i.insertBefore(n,i.firstChild.nextSibling)}},getPeaksForTimeSegment:function(e,t){var a=this.wavesurfer.backend.getDuration(),i=t-e,n=a*this.params.waveSegmentPeaksPerSegment/i,s=a/n,r=~~(e/s),m=~~(t/s),h=this.wavesurfer.backend.getPeaks(n,r,m),l=[];for(var g in h)"whole"==this.params.waveSegmentNormalizeTo?l.push(h[g]/this.maxPeak):l.push(h[g]);return l},appendWaveSegmentToElement:function(e,t){var a=this.ELAN.renderedAlignable[t],i=document.createElement("div"),n=this.params.waveSegmentWidth;i.style.width=(n+2*this.params.waveSegmentBorderWidth).toString()+"px",i.style.height=this.params.waveSegmentHeight.toString()+"px",i.className="elan-wavesegment-container",e.appendChild(i);var s=this.getPeaksForTimeSegment(a.start,a.end),r=this.params;r.fillParent=!0,r.height=this.params.waveSegmentHeight,r.barHeight=this.params.waveSegmentBarHeight,r.plotTimeStart=a.start,r.plotTimeEnd=a.end,r.fillParent=!0,r.scrollParent=!1,this.waveSegments[t]=Object.create(m.Drawer[this.params.waveSegmentRenderer]),this.waveSegments[t].init(i,r),this.waveSegments[t].drawPeaks(s,this.params.waveSegmentWidth*this.params.pixelRatio,0,this.params.waveSegmentPeaksPerSegment),this.waveSegments[t].updateProgress(0)},onProgress:function(e){for(var t=0;t<this.waveSegments.length;t++){var a,i=this.ELAN.renderedAlignable[t].start,n=this.ELAN.renderedAlignable[t].end;if(e<i)a=0;else if(n<e)a=this.params.waveSegmentWidth;else{a=(e-i)/(n-i)*this.params.waveSegmentWidth}this.waveSegments[t].updateProgress(a)}}},m.util.extend(m.ELANWaveSegment,m.Observer)});