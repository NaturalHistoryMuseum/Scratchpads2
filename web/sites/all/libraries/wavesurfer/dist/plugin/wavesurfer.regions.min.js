/*! wavesurfer.js 1.4.0 (Tue, 09 Oct 2018 15:21:58 GMT)
* https://github.com/katspaugh/wavesurfer.js
* @license BSD-3-Clause */
!function(e,t){void 0===e&&void 0!==window&&(e=window),"function"==typeof define&&define.amd?define(["wavesurfer"],function(e){return t(e)}):"object"==typeof module&&module.exports?module.exports=t(require("wavesurfer.js")):t(e.WaveSurfer)}(this,function(i){"use strict";i.Regions={init:function(e){this.wavesurfer=e,this.wrapper=this.wavesurfer.drawer.wrapper,this.list={}},add:function(e){var t=Object.create(i.Region);return t.init(e,this.wavesurfer),(this.list[t.id]=t).on("remove",function(){delete this.list[t.id]}.bind(this)),t},clear:function(){Object.keys(this.list).forEach(function(e){this.list[e].remove()},this)},enableDragSelection:function(n){var r,s,a,o,h=this,u=n.slop||2,d=0,e=function(e){e.touches&&1<e.touches.length||0<e.target.childElementCount||(o=e.targetTouches?e.targetTouches[0].identifier:null,r=!0,s=h.wavesurfer.drawer.handleEvent(e,!0),a=null)};this.wrapper.addEventListener("mousedown",e),this.wrapper.addEventListener("touchstart",e),this.on("disable-drag-selection",function(){h.wrapper.removeEventListener("touchstart",e),h.wrapper.removeEventListener("mousedown",e)});var t=function(e){e.touches&&1<e.touches.length||(r=!1,d=0,a&&(a.fireEvent("update-end",e),h.wavesurfer.fireEvent("region-update-end",a,e)),a=null)};this.wrapper.addEventListener("mouseup",t),this.wrapper.addEventListener("touchend",t),this.on("disable-drag-selection",function(){h.wrapper.removeEventListener("touchend",t),h.wrapper.removeEventListener("mouseup",t)});var i=function(e){if(r&&!(++d<=u||e.touches&&1<e.touches.length||e.targetTouches&&e.targetTouches[0].identifier!=o)){a||(a=h.add(n||{}));var t=h.wavesurfer.getDuration(),i=h.wavesurfer.drawer.handleEvent(e);a.update({start:Math.min(i*t,s*t),end:Math.max(i*t,s*t)})}};this.wrapper.addEventListener("mousemove",i),this.wrapper.addEventListener("touchmove",i),this.on("disable-drag-selection",function(){h.wrapper.removeEventListener("touchmove",i),h.wrapper.removeEventListener("mousemove",i)})},disableDragSelection:function(){this.fireEvent("disable-drag-selection")}},i.util.extend(i.Regions,i.Observer),i.Region={style:i.Drawer.style,init:function(e,t){this.wavesurfer=t,this.wrapper=t.drawer.wrapper,this.id=null==e.id?i.util.getId():e.id,this.start=Number(e.start)||0,this.end=null==e.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(e.end),this.resize=void 0===e.resize||Boolean(e.resize),this.drag=void 0===e.drag||Boolean(e.drag),this.loop=Boolean(e.loop),this.color=e.color||"rgba(0, 0, 0, 0.1)",this.data=e.data||{},this.attributes=e.attributes||{},this.maxLength=e.maxLength,this.minLength=e.minLength,this.bindInOut(),this.render(),this.onZoom=this.updateRender.bind(this),this.wavesurfer.on("zoom",this.onZoom),this.wavesurfer.fireEvent("region-created",this)},update:function(e){null!=e.start&&(this.start=Number(e.start)),null!=e.end&&(this.end=Number(e.end)),null!=e.loop&&(this.loop=Boolean(e.loop)),null!=e.color&&(this.color=e.color),null!=e.data&&(this.data=e.data),null!=e.resize&&(this.resize=Boolean(e.resize)),null!=e.drag&&(this.drag=Boolean(e.drag)),null!=e.maxLength&&(this.maxLength=Number(e.maxLength)),null!=e.minLength&&(this.minLength=Number(e.minLength)),null!=e.attributes&&(this.attributes=e.attributes),this.updateRender(),this.fireEvent("update"),this.wavesurfer.fireEvent("region-updated",this)},remove:function(){this.element&&(this.wrapper.removeChild(this.element),this.element=null,this.wavesurfer.un("zoom",this.onZoom),this.fireEvent("remove"),this.wavesurfer.fireEvent("region-removed",this))},play:function(){this.wavesurfer.play(this.start,this.end),this.fireEvent("play"),this.wavesurfer.fireEvent("region-play",this)},playLoop:function(){this.play(),this.once("out",this.playLoop.bind(this))},render:function(){var e=document.createElement("region");for(var t in e.className="wavesurfer-region",e.title=this.formatTime(this.start,this.end),e.setAttribute("data-id",this.id),this.attributes)e.setAttribute("data-region-"+t,this.attributes[t]);this.wrapper.scrollWidth;if(this.style(e,{position:"absolute",zIndex:2,height:"100%",top:"0px"}),this.resize){var i=e.appendChild(document.createElement("handle")),n=e.appendChild(document.createElement("handle"));i.className="wavesurfer-handle wavesurfer-handle-start",n.className="wavesurfer-handle wavesurfer-handle-end";var r={cursor:"col-resize",position:"absolute",left:"0px",top:"0px",width:"1%",maxWidth:"4px",height:"100%"};this.style(i,r),this.style(n,r),this.style(n,{left:"100%"})}this.element=this.wrapper.appendChild(e),this.updateRender(),this.bindEvents(e)},formatTime:function(e,t){return(e==t?[e]:[e,t]).map(function(e){return[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2)].join(":")}).join("-")},getWidth:function(){return this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio},updateRender:function(){var e=this.wavesurfer.getDuration(),t=this.getWidth();if(this.start<0&&(this.start=0,this.end=this.end-this.start),this.end>e&&(this.end=e,this.start=e-(this.end-this.start)),null!=this.minLength&&(this.end=Math.max(this.start+this.minLength,this.end)),null!=this.maxLength&&(this.end=Math.min(this.start+this.maxLength,this.end)),null!=this.element){var i=Math.round(this.start/e*t),n=Math.round(this.end/e*t)-i;for(var r in this.style(this.element,{left:i+"px",width:n+"px",backgroundColor:this.color,cursor:this.drag?"move":"default"}),this.attributes)this.element.setAttribute("data-region-"+r,this.attributes[r]);this.element.title=this.formatTime(this.start,this.end)}},bindInOut:function(){var t=this;t.firedIn=!1,t.firedOut=!1;var e=function(e){!t.firedOut&&t.firedIn&&(t.start>=Math.round(100*e)/100||t.end<=Math.round(100*e)/100)&&(t.firedOut=!0,t.firedIn=!1,t.fireEvent("out"),t.wavesurfer.fireEvent("region-out",t)),!t.firedIn&&t.start<=e&&t.end>e&&(t.firedIn=!0,t.firedOut=!1,t.fireEvent("in"),t.wavesurfer.fireEvent("region-in",t))};this.wavesurfer.backend.on("audioprocess",e),this.on("remove",function(){t.wavesurfer.backend.un("audioprocess",e)}),this.on("out",function(){t.loop&&t.wavesurfer.play(t.start)})},bindEvents:function(){var n,r,s,a,o,e,t,i,h=this;this.element.addEventListener("mouseenter",function(e){h.fireEvent("mouseenter",e),h.wavesurfer.fireEvent("region-mouseenter",h,e)}),this.element.addEventListener("mouseleave",function(e){h.fireEvent("mouseleave",e),h.wavesurfer.fireEvent("region-mouseleave",h,e)}),this.element.addEventListener("click",function(e){e.preventDefault(),h.fireEvent("click",e),h.wavesurfer.fireEvent("region-click",h,e)}),this.element.addEventListener("dblclick",function(e){e.stopPropagation(),e.preventDefault(),h.fireEvent("dblclick",e),h.wavesurfer.fireEvent("region-dblclick",h,e)}),(this.drag||this.resize)&&(o=h.wavesurfer.getDuration(),e=function(e){e.touches&&1<e.touches.length||(a=e.targetTouches?e.targetTouches[0].identifier:null,e.stopPropagation(),s=h.wavesurfer.drawer.handleEvent(e,!0)*o,r="handle"==e.target.tagName.toLowerCase()?e.target.classList.contains("wavesurfer-handle-start")?"start":"end":!(n=!0))},t=function(e){e.touches&&1<e.touches.length||(n||r)&&(r=n=!1,h.fireEvent("update-end",e),h.wavesurfer.fireEvent("region-update-end",h,e))},i=function(e){if(!(e.touches&&1<e.touches.length)&&(!e.targetTouches||e.targetTouches[0].identifier==a)&&(n||r)){var t=h.wavesurfer.drawer.handleEvent(e)*o,i=t-s;s=t,h.drag&&n&&h.onDrag(i),h.resize&&r&&h.onResize(i,r)}},h.element.addEventListener("mousedown",e),h.element.addEventListener("touchstart",e),h.wrapper.addEventListener("mousemove",i),h.wrapper.addEventListener("touchmove",i),document.body.addEventListener("mouseup",t),document.body.addEventListener("touchend",t),h.on("remove",function(){document.body.removeEventListener("mouseup",t),document.body.removeEventListener("touchend",t),h.wrapper.removeEventListener("mousemove",i),h.wrapper.removeEventListener("touchmove",i)}),h.wavesurfer.on("destroy",function(){document.body.removeEventListener("mouseup",t),document.body.removeEventListener("touchend",t)}))},onDrag:function(e){var t=this.wavesurfer.getDuration();this.end+e>t||this.start+e<0||this.update({start:this.start+e,end:this.end+e})},onResize:function(e,t){"start"==t?this.update({start:Math.min(this.start+e,this.end),end:Math.max(this.start+e,this.end)}):this.update({start:Math.min(this.end+e,this.start),end:Math.max(this.end+e,this.start)})}},i.util.extend(i.Region,i.Observer),i.initRegions=function(){this.regions||(this.regions=Object.create(i.Regions),this.regions.init(this))},i.addRegion=function(e){return this.initRegions(),this.regions.add(e)},i.clearRegions=function(){this.regions&&this.regions.clear()},i.enableDragSelection=function(e){this.initRegions(),this.regions.enableDragSelection(e)},i.disableDragSelection=function(){this.regions.disableDragSelection()}});