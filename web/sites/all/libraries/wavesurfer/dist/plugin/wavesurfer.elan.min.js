/*! wavesurfer.js 1.4.0 (Tue, 09 Oct 2018 15:21:58 GMT)
* https://github.com/katspaugh/wavesurfer.js
* @license BSD-3-Clause */
!function(e,t){void 0===e&&void 0!==window&&(e=window),"function"==typeof define&&define.amd?define(["wavesurfer"],function(e){return t(e)}):"object"==typeof module&&module.exports?module.exports=t(require("wavesurfer.js")):t(e.WaveSurfer)}(this,function(e){"use strict";e.ELAN={Types:{ALIGNABLE_ANNOTATION:"ALIGNABLE_ANNOTATION",REF_ANNOTATION:"REF_ANNOTATION"},init:function(e){if(this.data=null,this.params=e,this.container="string"==typeof e.container?document.querySelector(e.container):e.container,!this.container)throw Error("No container for ELAN");this.bindClick(),e.url&&this.load(e.url)},load:function(e){var t=this;this.loadXML(e,function(e){t.data=t.parseElan(e),t.render(),t.fireEvent("ready",t.data)})},loadXML:function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="document",n.send(),n.addEventListener("load",function(e){t&&t(e.target.responseXML)})},parseElan:function(e){var t=Array.prototype.forEach,n=Array.prototype.map,r={media:{},timeOrder:{},tiers:[],annotations:{},alignableAnnotations:[]},a=e.querySelector("HEADER"),i="milliseconds"==a.getAttribute("TIME_UNITS"),o=a.querySelector("MEDIA_DESCRIPTOR");r.media.url=o.getAttribute("MEDIA_URL"),r.media.type=o.getAttribute("MIME_TYPE");var s=e.querySelectorAll("TIME_ORDER TIME_SLOT"),d={};return t.call(s,function(e){var t=parseFloat(e.getAttribute("TIME_VALUE"));i&&(t=Math.round(100*t)/1e5),d[e.getAttribute("TIME_SLOT_ID")]=t}),r.tiers=n.call(e.querySelectorAll("TIER"),function(e){return{id:e.getAttribute("TIER_ID"),linguisticTypeRef:e.getAttribute("LINGUISTIC_TYPE_REF"),defaultLocale:e.getAttribute("DEFAULT_LOCALE"),annotations:n.call(e.querySelectorAll("REF_ANNOTATION, ALIGNABLE_ANNOTATION"),function(e){var t={type:e.nodeName,id:e.getAttribute("ANNOTATION_ID"),ref:e.getAttribute("ANNOTATION_REF"),value:e.querySelector("ANNOTATION_VALUE").textContent.trim()};return this.Types.ALIGNABLE_ANNOTATION==t.type&&(t.start=d[e.getAttribute("TIME_SLOT_REF1")],t.end=d[e.getAttribute("TIME_SLOT_REF2")],r.alignableAnnotations.push(t)),r.annotations[t.id]=t},this)}},this),r.tiers.forEach(function(e){e.annotations.forEach(function(e){null!=e.ref&&(e.reference=r.annotations[e.ref])},this)},this),r.alignableAnnotations.sort(function(e,t){var n=e.start-t.start;return 0==n&&(n=t.end-e.end),n}),r.length=r.alignableAnnotations.length,r},render:function(){var s=this.data.tiers;this.params.tiers&&(s=s.filter(function(e){return e.id in this.params.tiers},this));var n={},r={};s.forEach(function(e,t){e.annotations.forEach(function(e){e.reference&&e.reference.type==this.Types.ALIGNABLE_ANNOTATION&&(e.reference.id in n||(n[e.ref]={}),n[e.ref][t]=e,r[t]=!0)},this)},this),r=Object.keys(r).sort(),this.renderedAlignable=this.data.alignableAnnotations.filter(function(e){return n[e.id]});var e=document.createElement("table");e.className="wavesurfer-annotations";var t=document.createElement("thead"),a=document.createElement("tr");t.appendChild(a),e.appendChild(t);var i=document.createElement("th");i.textContent="Time",i.className="wavesurfer-time",a.appendChild(i),r.forEach(function(e){var t=s[e],n=document.createElement("th");n.className="wavesurfer-tier-"+t.id,n.textContent=t.id,n.style.width=this.params.tiers[t.id],a.appendChild(n)},this);var d=document.createElement("tbody");e.appendChild(d),this.renderedAlignable.forEach(function(a){var i=document.createElement("tr");i.id="wavesurfer-alignable-"+a.id,d.appendChild(i);var e=document.createElement("td");e.className="wavesurfer-time",e.textContent=a.start.toFixed(1)+"â€“"+a.end.toFixed(1),i.appendChild(e);var o=n[a.id];r.forEach(function(e){var t=s[e],n=document.createElement("td"),r=o[e];r&&(n.id="wavesurfer-annotation-"+r.id,n.dataset.ref=a.id,n.dataset.start=a.start,n.dataset.end=a.end,n.textContent=r.value),n.className="wavesurfer-tier-"+t.id,i.appendChild(n)},this)},this),this.container.innerHTML="",this.container.appendChild(e)},bindClick:function(){var r=this;this.container.addEventListener("click",function(e){var t=e.target.dataset.ref;if(null!=t){var n=r.data.annotations[t];n&&r.fireEvent("select",n.start,n.end)}})},getRenderedAnnotation:function(t){var n;return this.renderedAlignable.some(function(e){return e.start<=t&&e.end>=t&&(n=e,!0)}),n},getAnnotationNode:function(e){return document.getElementById("wavesurfer-alignable-"+e.id)}},e.util.extend(e.ELAN,e.Observer)});